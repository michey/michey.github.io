<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="my-awesome-blog" property="og:site_name">

  <meta content="Slick and Tuple22 limitation" property="og:title">


  <meta content="article" property="og:type">


  <meta content=" <h3>Hello</h3> Here will be my awesome blog with some posts about programming. <br> At first all posts will be writtenin in Russian languane and then rewrited in English. <br> Здесь будет мой замечательный блог с постами про программирование. <br> Сначала посты будут выходить на русском, потом переводиться на английский" property="og:description">


  <meta content="https://michey.github.io/dev/2016/06/14/slick22-en.html" property="og:url">


  <meta content="2016-06-14T21:00:00+03:00" property="article:published_time">
  <meta content="https://michey.github.io/about/" property="article:author">


  <meta property="og:image" content="">


  
  <meta content="dev" property="article:section">
  


  
  <meta content="slick" property="article:tag">
  
  <meta content="scala" property="article:tag">
  
  <meta content="shapeless" property="article:tag">
  
  <meta content="en" property="article:tag">
  

  <title>Slick and Tuple22 limitation</title>
  <meta name="description" content="Synopsis:Sometimes, when you implementing single table inheritance you could stuck with scala Tuple22 limitation.When number of columns is greater than 22 yo...">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/main.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <link href='https://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Fira+Mono' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,200,300,500,600,700,900' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Gentium+Basic:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Alegreya:400,400italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lora:400,400italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Fira+Sans:400,300,500,700' rel='stylesheet' type='text/css'>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous">
  <link rel="canonical" href="https://michey.github.io/dev/2016/06/14/slick22-en.html">
  <link rel="alternate" type="application/rss+xml" title="my-awesome-blog" href="https://michey.github.io/feed.xml">
</head>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-50829185-2', 'auto');
    ga('send', 'pageview');

</script>



<body>
<section>
    <nav class="navbar navbar-default navbar-fixed-top">

        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">my-awesome-blog</a>
            </div>


            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    

                    

                    <li><a href="/about/">About</a></li>

                    

                    

                    

                    

                    

                    

                    

                    

                    

                    

                    

                    <li><a href="/tags">Tags</a></li>

                    

                    


                </ul>

                <!--  <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">Know More!</a></li>

                  </ul>-->
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
</section>

<section>
    <article class="post" itemscope itemtype="http://schema.org/Blog">
    <div class="jumbotron">
        <div class="container">
            <h1 class="post-title-main" itemprop="name headline">Slick and Tuple22 limitation</h1>
            <p class="post-meta">
                <time datetime="2016-06-14T21:00:00+03:00" content="2016-06-14T21:00:00+03:00"
                      itemprop="datePublished">Jun 14, 2016
                </time>
                
                • <span itemprop="author" itemscope itemtype="http://schema.org/Person">
                    <span itemprop="name">Alexander Mihailov</span>
                  </span>
                
            </p>
            <ul class="tags" itemprop="articleSection">
                
                <li><a href="/tags#slick" class="tag">slick</a></li>
                
                <li><a href="/tags#scala" class="tag">scala</a></li>
                
                <li><a href="/tags#shapeless" class="tag">shapeless</a></li>
                
                <li><a href="/tags#en" class="tag">en</a></li>
                
            </ul>

        </div>

    </div>

    <div class="post-content container" itemprop="articleBody">
        <h3 id="synopsis">Synopsis:</h3>
<p>Sometimes, when you implementing single table inheritance you could stuck with scala Tuple22 limitation.
When number of columns is greater than 22 you lost easy to use two way binding between row and case class.
You could try to pass through this limitation by writing more than one slick schema to access the rows, 
but it will increase the number of queries to DB.
I think the easiest way to fix this problem - use shapeless with slickless.</p>

<p>Full source code available at <a href="https://github.com/michey/slick-22">slick-22</a></p>

<h3 id="solution">Solution:</h3>
<p>Solution is extremely easy.</p>

<ol>
  <li>Write case class</li>
  <li>Write your schema with heterogeneous list from shapeless lib.</li>
  <li>Convert heterogeneous list to case class with help of shapeless Generic.</li>
</ol>

<h3 id="much-details">Much details:</h3>

<p>Add shapeless and slickless to dependencies.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre> <span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
   <span class="s">"io.underscore"</span> <span class="o">%%</span> <span class="s">"slickless"</span> <span class="o">%</span> <span class="s">"0.2.0"</span><span class="o">,</span>
   <span class="s">"com.chuusai"</span> <span class="o">%%</span> <span class="s">"shapeless"</span> <span class="o">%</span> <span class="s">"2.3.0"</span>
   <span class="o">)</span>
 <span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Write case class</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">Entity</span><span class="o">(</span><span class="n">f1</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">,</span>
                  <span class="n">f2</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                  <span class="o">...</span>
                  <span class="n">f23</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Write schema with heterogeneous list.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="k">object</span> <span class="nc">EntityDao</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">entityGeneric</span> <span class="k">=</span> <span class="nc">Generic</span><span class="o">[</span><span class="kt">Entity</span><span class="o">]</span>

  <span class="k">val</span> <span class="n">query</span> <span class="k">=</span> <span class="nc">TableQuery</span><span class="o">[</span><span class="kt">Schema</span><span class="o">]</span>


  <span class="k">class</span> <span class="nc">Schema</span><span class="o">(</span><span class="n">tag</span><span class="k">:</span> <span class="kt">Tag</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">entityGeneric.Repr</span><span class="o">](</span><span class="n">tag</span><span class="o">,</span> <span class="s">"entity"</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">def</span> <span class="o">*</span> <span class="k">=</span> <span class="n">f1</span> <span class="o">::</span> <span class="n">f2</span> <span class="o">::</span> <span class="n">f3</span> <span class="o">::</span> <span class="n">f4</span> <span class="o">::</span> <span class="n">f5</span> <span class="o">::</span> <span class="n">f6</span> <span class="o">::</span> <span class="n">f7</span> <span class="o">::</span> <span class="n">f8</span> <span class="o">::</span> <span class="n">f9</span> <span class="o">::</span> <span class="n">f10</span> <span class="o">::</span> <span class="n">f11</span> <span class="o">::</span>
      <span class="n">f12</span> <span class="o">::</span> <span class="n">f13</span> <span class="o">::</span> <span class="n">f14</span> <span class="o">::</span> <span class="n">f15</span> <span class="o">::</span> <span class="n">f16</span> <span class="o">::</span> <span class="n">f17</span> <span class="o">::</span> <span class="n">f18</span> <span class="o">::</span> <span class="n">f19</span> <span class="o">::</span> <span class="n">f20</span> <span class="o">::</span> <span class="n">f21</span> <span class="o">::</span> <span class="n">f22</span> <span class="o">::</span> <span class="n">f23</span> <span class="o">::</span> <span class="nc">HNil</span>

    <span class="k">def</span> <span class="n">f1</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">UUID</span><span class="o">](</span><span class="s">"f1"</span><span class="o">,</span> <span class="n">O</span><span class="o">.</span><span class="nc">PrimaryKey</span><span class="o">)</span>

    <span class="k">def</span> <span class="n">f2</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"f2"</span><span class="o">)</span>

   <span class="o">...</span>
   
    <span class="k">def</span> <span class="n">f23</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"f23"</span><span class="o">)</span>
  <span class="o">}</span>


<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Don’t forget to use shapeless Generic.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Storage</span><span class="o">(</span><span class="n">db</span><span class="k">:</span> <span class="kt">Database</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">getEntityByf1</span><span class="o">(</span><span class="n">f1</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">Entity</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">request</span> <span class="k">=</span> <span class="nc">EntityDao</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">f1</span> <span class="o">===</span> <span class="n">f1</span><span class="o">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="n">result</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span>
      <span class="k">_</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span>
        <span class="nc">EntityDao</span><span class="o">.</span><span class="n">entityGeneric</span><span class="o">.</span><span class="n">from</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">saveEntity</span><span class="o">(</span><span class="n">entity</span><span class="k">:</span> <span class="kt">Entity</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">db</span><span class="o">.</span><span class="n">run</span> <span class="o">{</span>
      <span class="nc">EntityDao</span><span class="o">.</span><span class="n">query</span> <span class="o">+=</span> <span class="nc">EntityDao</span><span class="o">.</span><span class="n">entityGeneric</span><span class="o">.</span><span class="n">to</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>


    </div>

</article>

</section>
<nav class="navbar navbar-default navbar-fixed-bottom">
    <div class="container footer-content">
        <!--Made with <i class ="fa fa-heart"></i> by Alexandr Mihailov<br>-->
        Powered By Jekyll
    </div>
</nav>

</body>

</html>
